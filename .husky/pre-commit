#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

if [ -z "$SKIP_VERSION_BUMP" ]; then
	printf 'üî¢ Auto incrementing patch version...\n'
	npm version patch --no-git-tag-version >/dev/null 2>&1 || {
		printf '‚ùå Failed to bump patch version. Aborting commit.\n'
		exit 1
	}
	NEW_VERSION=$(node -pe "require('./package.json').version")
	printf '‚úÖ Version bumped to %s\n' "$NEW_VERSION"

	# Update version in README.md
	node -e "
const fs = require('fs');
const content = fs.readFileSync('README.md', 'utf-8');
const newContent = content.replace(/(\*\*Vers√£o narrativa:\*\* )[\d.]+/, '\$1$NEW_VERSION');
fs.writeFileSync('README.md', newContent);
"

	git add package.json package-lock.json README.md
fi

printf 'üß™ Running tests...\n'
npm test
